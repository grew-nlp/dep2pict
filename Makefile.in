all: opt

include config/Makefile

byte :
	@make -C src byte

opt :
ifeq (@BUILD_GUI@,yes)
	@make -C src opt_gtk
else
	@make -C src opt
endif

conf : config/configure.ac
	cd config && rm -rf ac_lib_checking.*
	cd config && wget https://gforge.inria.fr/scm/viewvc.php/*checkout*/ac_lib_checking/ac_lib_checking.m4?root=semagramme --no-check-certificate || true
	cd config && mv ac_lib_checking.m4?root=semagramme ac_lib_checking.m4 || true
	cd config && aclocal
	cd config && autoconf -o ../configure configure.ac
	rm -rf config.status config.log autom4te.cache config/autom4te.cache

install : opt
	cp bin/dep2pict.opt $(INSTALL_DIR)/dep2pict
ifeq (@BUILD_GUI@,yes)
	mkdir -p $(DATA_DIR)
	cp src/dep2pict.glade $(DATA_DIR)
	cp img/* $(DATA_DIR)
endif


clean :
	@make cleanup
	@make -C config cleanup
	@make -C src cleanup

purge_makefile :
	@make purge
	@make -C src purge
	@make -C config purge


destroot:
	mkdir -p $(DESTDIR)$(INSTALL_DIR)
	mkdir -p $(DESTDIR)$(DATA_DIR)
	cp bin/dep2pict.opt $(DESTDIR)$(INSTALL_DIR)/dep2pict
ifeq (@BUILD_GUI@,yes)
	cp src/dep2pict.glade $(DESTDIR)$(DATA_DIR)
	cp img/* $(DESTDIR)$(DATA_DIR)
endif
